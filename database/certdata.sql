CREATE DATABASE asl_certdata;
USE asl_certdata;

CREATE TABLE certificates (
	serial_nr BIGINT(20) UNSIGNED PRIMARY KEY,
	user VARCHAR(64) NOT NULL,
	pkcs12 LONGBLOB NOT NULL,
	salt CHAR(128) NOT NULL,
	purpose TEXT NOT NULL,
	created DATETIME NOT NULL,
	revoked DATETIME DEFAULT NULL
);

INSERT INTO certificates (serial_nr, user, pkcs12, salt, purpose, created) VALUES (0, 'system', 'undisclosed_pkcs12', '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'Root certificate of iMovie CA', '0000-01-01 00:00:00'), (1, 'system', 'undisclosed_pkcs12', '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'ca.api.imovie.local', '0000-01-01 00:00:00'), (2, 'system', 'undisclosed_pkcs12', '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'certdata.api.imovie.local', '0000-01-01 00:00:00'), (3, 'system', 'undisclosed_pkcs12', '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'userdata.api.imovie.local', '0000-01-01 00:00:00'), (4, 'system', 'undisclosed_pkcs12', '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'www.imovie.local', '0000-01-01 00:00:00'), (5, 'system', 'undisclosed_pkcs12', '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'admin.imovie.local', '0000-01-01 00:00:00');

CREATE USER 'asl_certdata_user'@'localhost' IDENTIFIED BY '5a6fcd26632e120cffbb';

GRANT SELECT, INSERT, UPDATE (revoked) ON certificates TO 'asl_certdata_user'@'localhost';

SELECT 'Database setup of asl_certdata finished' AS ' ';
